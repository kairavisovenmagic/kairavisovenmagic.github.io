<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Login — Kairavi’s Oven Magic</title>
  <link rel="icon" href="images/logo.png"/>
  <link rel="stylesheet" href="style.css"/>
  <style>
    :root{
      --bg:#FFF7F0; --card:#ffffff; --text:#2a2a2a; --muted:#6c6c6c;
      --brand:#f15a24; --brand-900:#cc4b1e; --ring:rgba(241,90,36,.35);
      --radius:16px; --shadow:0 10px 25px rgba(0,0,0,.06);
    }
    body{ background:var(--bg); color:var(--text); }
    .auth-wrap{ max-width:980px; margin:40px auto; padding:0 16px; }
    .auth-title{ font-size:42px; line-height:1.15; margin:12px 0 8px; }
    .auth-sub{ color:var(--muted); margin-bottom:20px; }
    .auth-grid{ display:grid; grid-template-columns:1fr; gap:18px; }
    @media (min-width:900px){ .auth-grid{ grid-template-columns: 1.1fr .9fr; gap:24px; } }
    .auth-card,.side-card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px; }
    label{ display:block; font-size:14px; color:var(--muted); margin:10px 0 6px; }
    input[type=email], input[type=password]{
      width:100%; padding:12px 14px; border:1px solid #ddd; border-radius:12px; outline:none;
      transition:border .15s, box-shadow .15s; background:#fff;
    }
    input:focus{ border-color:var(--brand); box-shadow:0 0 0 4px var(--ring); }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:10px;
      border:1px solid #ddd; padding:12px 16px; border-radius:12px; cursor:pointer; background:#fff; }
    .btn:hover{ background:#fafafa; }
    .btn-primary{ background:var(--brand); color:#fff; border:1px solid var(--brand); }
    .btn-primary:hover{ background:var(--brand-900); border-color:var(--brand-900); }
    .btn-block{ width:100%; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .center{ text-align:center; }
    .divider{ color:var(--muted); margin:4px 0 10px; }
    .google-btn{ border:1px solid #e7e7e7; background:#fff; font-weight:600;
      display:flex; align-items:center; justify-content:center; gap:10px;
      padding:14px 18px; border-radius:12px; }
    .google-btn:hover{ background:#f7f7f7; }
    .bullet{ margin:0; padding-left:18px; }
    .bullet li{ margin:6px 0; color:#444; }
    .smallmuted{ color:var(--muted); font-size:12px; margin-top:6px; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav">
      <a class="brand" href="index.html">
        <img src="images/logo.png" alt="logo"/><strong>Kairavi’s Oven Magic</strong>
      </a>
      <nav class="menu">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a id="loginLink" href="login.html" aria-current="page">Login</a>
        <a id="logoutLink" href="#" style="display:none">Logout</a>
      </nav>
    </div>
  </header>

  <main class="auth-wrap">
    <h1 class="auth-title">Login / Sign Up</h1>
    <p class="auth-sub">Use email & password or continue with Google.</p>

    <div class="auth-grid">
      <!-- LEFT: Form -->
      <section class="auth-card" aria-label="Email password sign in">
        <form onsubmit="return false;">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@example.com" autocomplete="username" required/>

          <label for="password">Password</label>
          <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" required/>

          <div class="row" style="margin-top:14px">
            <button id="btnSignIn" class="btn btn-primary" type="button">Sign In</button>
            <button id="btnSignUp" class="btn" type="button">Create Account</button>
            <a id="btnReset" class="btn" href="#" title="Reset password">Forgot?</a>
          </div>
        </form>

        <div class="center divider">— or —</div>

        <button id="btnGoogle" class="google-btn btn-block" type="button" aria-label="Continue with Google">
          <img src="images/google.svg" alt="" style="height:18px"/>
          Continue with Google
        </button>
        <div class="smallmuted">If the Google popup is blocked, we’ll automatically use a full-page redirect.</div>
      </section>

      <!-- RIGHT: Trust/benefits -->
      <aside class="side-card">
        <h3 style="margin:0 0 8px">Why create an account?</h3>
        <ul class="bullet">
          <li>Faster re-orders & saved details</li>
          <li>Exclusive festive offers & drops</li>
          <li>Track orders & invoices easily</li>
        </ul>
        <p class="smallmuted">By continuing, you agree to our basic terms of use.</p>
      </aside>
    </div>
  </main>

  <div id="authErrorBanner" style="display:none;position:fixed;left:0;right:0;top:0;padding:10px 16px;background:#ffeded;color:#8a1f1f;border-bottom:1px solid #e4bcbc;z-index:9999;text-align:center;font-weight:600">
    Login script failed to load. Check that <code>auth.js</code> is beside this file and imported with <code>./auth.js?v=3</code>.
  </div>
  <div class="toast" style="display:block;opacity:0;pointer-events:none"></div>

  <script type="module">
    const ready = (fn) => (document.readyState !== 'loading') ? fn() : document.addEventListener('DOMContentLoaded', fn);

    ready(async () => {
      const showBanner = (msg) => {
        const b = document.getElementById('authErrorBanner');
        b.style.display = 'block';
        if (msg) b.innerHTML = msg;
      };

      try {
        // cache-busted import
        const mod = await import('./auth.js?v=3');

        const {
          attachHeaderAuth, toast, ADMIN_EMAILS, auth,
          signInWithGoogleFlow, completeGoogleRedirectIfNeeded,
          emailPasswordSignIn, emailPasswordSignUp, requestPasswordReset
        } = mod;

        attachHeaderAuth();
        await completeGoogleRedirectIfNeeded();

        const emailEl = document.getElementById('email');
        const passEl  = document.getElementById('password');
        const next = new URLSearchParams(location.search).get('next') || 'my-account.html';

        document.getElementById('btnSignIn').addEventListener('click', async () => {
          try {
            const email = emailEl.value.trim(); const pass = passEl.value;
            if (!email || !pass) return toast('Enter email & password');
            await emailPasswordSignIn(email, pass);
            toast('Welcome back!'); setTimeout(()=> location.href = next, 300);
          } catch (e) { console.error(e); toast(e?.message || 'Sign-in failed'); }
        });

        document.getElementById('btnSignUp').addEventListener('click', async () => {
          try {
            const email = emailEl.value.trim(); const pass = passEl.value;
            if (!email || !pass) return toast('Enter email & password');
            await emailPasswordSignUp(email, pass);
            toast('Account created!'); setTimeout(()=> location.href = 'my-account.html', 300);
          } catch (e) { console.error(e); toast(e?.message || 'Sign-up failed'); }
        });

        document.getElementById('btnReset').addEventListener('click', async (e) => {
          e.preventDefault();
          try {
            const email = emailEl.value.trim();
            if (!email) return toast('Enter your email above first');
            await requestPasswordReset(email);
            toast('Reset link sent to your email');
          } catch (e2) { console.error(e2); toast(e2?.message || 'Could not send reset email'); }
        });

        document.getElementById('btnGoogle').addEventListener('click', async () => {
          try {
            await signInWithGoogleFlow(); // popup or redirect
            setTimeout(()=> location.href = next, 200);
          } catch (e) {
            console.error('Google sign-in error:', e);
            if (!(String(e?.message||'').toLowerCase().includes('popup'))) {
              toast(e?.message || 'Google sign-in failed');
            }
          }
        });
      } catch (err) {
        console.error('Failed to import ./auth.js?v=3', err);
        showBanner('Login script failed to load. Ensure <code>auth.js</code> is beside this file and imported with <code>./auth.js?v=3</code>.');
      }
    });
  </script>
</body>
</html>
