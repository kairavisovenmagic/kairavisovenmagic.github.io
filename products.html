<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Products | Kairavi’s Oven Magic</title>
  <link rel="icon" href="images/logo.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta name="description" content="Freshly baked cookies & nankhatai made with 100% atta and pure butter. Order from Kairavi’s Oven Magic, Pune." />
</head>
<body>

  <!-- FREE DELIVERY BAR -->
  <div class="freebar">
    FREE delivery over ₹999 • Pune city
    <a href="cart.html">View Cart →</a>
  </div>

  <!-- HEADER -->
  <header class="site-header">
    <div class="wrap nav">
      <a class="brand" href="index.html">
        <img src="images/logo.png" alt="Kairavi's Oven Magic logo">
        <strong>Kairavi’s Oven Magic</strong>
      </a>
      <nav class="menu">
        <a href="index.html">Home</a>
        <a href="products.html" aria-current="page">Products</a>
        <a href="contact.html">Contact</a>
        <a href="cart.html">Cart <span class="badge" id="cartCount">0</span></a>
        <a id="loginLink" href="login.html">Login</a>
      </nav>
    </div>
  </header>

  <!-- PAGE BANNER -->
  <section class="products-hero">
    <div class="wrap products-hero-inner">
      <div>
        <h1 class="products-title">Our Cookies & Nankhatai</h1>
        <p class="products-sub">100% atta • Pure unsalted butter • No maida • No palm oil</p>
      </div>
      <div class="legend">
        <span class="legend-dot best"></span><span>Bestseller</span>
        <span class="legend-dot new"></span><span>New</span>
      </div>
    </div>
  </section>

  <!-- FILTER BAR -->
  <div class="filterbar stick" role="region" aria-label="Filters">
    <div class="wrap filterbar-inner">
      <div class="filter-left">
        <div class="search-wrap">
          <i class="fa fa-magnifying-glass"></i>
          <input id="q" type="search" placeholder="Search by name (e.g., ragi, gulkand)…" aria-label="Search products"/>
        </div>

        <label class="select">
          <span>Max price</span>
          <select id="priceMax" aria-label="Maximum price">
            <option value="">No limit</option>
            <option value="200">₹200</option>
            <option value="250">₹250</option>
          </select>
        </label>

        <label class="check"><input type="checkbox" id="onlyBest"> <span>Bestseller only</span></label>
      </div>

      <div class="filter-right">
        <div id="resultCount" class="result-count">Showing 0 items</div>
        <button class="btn btn-ghost" id="clearFilters" type="button"><i class="fa fa-rotate-right"></i> Clear</button>
      </div>
    </div>
  </div>

  <!-- SECTION: PRODUCTS GRID -->
  <section class="section section-products">
    <div class="wrap">
      <div class="grid pro-grid" id="productsGrid">
        <!-- All your product cards remain unchanged -->
        <!-- (Paste all cards exactly as in your version above) -->
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="wrap footer-grid">
      <div class="small">© 2025 Kairavi’s Oven Magic — Kairavi Food Products</div>
      <div class="small" style="text-align:right">
        Email: <a href="mailto:kairavisovenmagic@gmail.com">kairavisovenmagic@gmail.com</a>
      </div>
    </div>
  </footer>

  <!-- WhatsApp Floating -->
  <a class="whatsapp-float" href="https://wa.me/919766964845?text=Hi%2C%20I%20want%20to%20order%20cookies" target="_blank" aria-label="Chat on WhatsApp">
    <img src="images/whatsapp.png" alt="WhatsApp">
  </a>

  <!-- Qty + Cart + Filter logic -->
  <script>
    const CART_KEY = 'kom_cart';

    function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }
    function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); updateCartCount(); toast('Added to cart'); }
    function updateCartCount(){
      const el = document.getElementById('cartCount');
      if(!el) return;
      const qty = getCart().reduce((s,i)=>s+i.qty,0);
      el.textContent = qty;
    }
    function toast(msg){
      let t=document.querySelector('.toast'); 
      if(!t){ t=document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
      t.textContent=msg; t.classList.add('show'); 
      setTimeout(()=>t.classList.remove('show'),1100);
    }

    // Initialize product cards
    document.querySelectorAll('.card').forEach(card => {
      const name = card.dataset.product;
      const weight = card.dataset.weight;
      const basePrice = parseInt(card.dataset.price || card.querySelector('.price').dataset.price, 10);

      const priceEl = card.querySelector('.price');
      const minus = card.querySelector('.minus');
      const plus = card.querySelector('.plus');
      const remove = card.querySelector('.remove');
      const countEl = card.querySelector('.count');
      const addBtn = card.querySelector('.addbtn');

      let qty = 1;
      function update(){ priceEl.textContent = `₹${basePrice * qty}`; countEl.textContent = qty; }
      minus.addEventListener('click', () => { if (qty > 1) { qty--; update(); } });
      plus .addEventListener('click', () => { if (qty < 10){ qty++; update(); } });
      remove.addEventListener('click', () => { qty = 1; update(); });

      addBtn.addEventListener('click', e=>{
        e.preventDefault();
        const cart=getCart();
        const key=`${name}|${weight}|${basePrice}`;
        const found=cart.find(i=>i.key===key);
        if(found){ found.qty += qty; } else { cart.push({ key, name, weight, price: basePrice, qty }); }
        saveCart(cart);
      });

      update();
    });

    updateCartCount();

    // ------ Filters ------
    const q = document.getElementById('q');
    const priceMax = document.getElementById('priceMax');
    const onlyBest = document.getElementById('onlyBest');
    const clearFilters = document.getElementById('clearFilters');
    const resultCount = document.getElementById('resultCount');

    function applyFilters(){
      const term = q.value.trim().toLowerCase();
      const max = priceMax.value ? parseInt(priceMax.value,10) : Infinity;
      const best = onlyBest.checked;

      let visible = 0;
      document.querySelectorAll('.card').forEach(card=>{
        const name = card.dataset.product.toLowerCase();
        const tags = (card.dataset.tags||'').toLowerCase();
        const price = parseInt(card.dataset.price,10);
        const isBest = card.classList.contains('best');

        const textMatch = !term || name.includes(term) || tags.includes(term);
        const priceMatch = price <= max;
        const bestMatch  = !best || isBest;

        const show = (textMatch && priceMatch && bestMatch);
        card.style.display = show ? '' : 'none';
        if(show) visible++;
      });
      if(resultCount) resultCount.textContent = `Showing ${visible} item${visible===1?'':'s'}`;
    }
    [q, priceMax, onlyBest].forEach(el=> el.addEventListener('input', applyFilters));
    clearFilters.addEventListener('click', ()=>{
      q.value=''; priceMax.value=''; onlyBest.checked=false; applyFilters();
    });
    applyFilters();
  </script>

  <div class="toast" style="display:none"></div>

  <!-- Firebase: auto-switch Login → My Account -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';

    const app = initializeApp({
      apiKey: "AIzaSyCk4rYYxGWI9XBLXiIR1uaIFAnf8WHZP2w",
      authDomain: "kairavis-oven-magic.firebaseapp.com",
      projectId: "kairavis-oven-magic",
      storageBucket: "kairavis-oven-magic.firebasestorage.app",
      messagingSenderId: "270897232759",
      appId: "1:270897232759:web:36ee0edc8b222046febf72"
    });
    const auth = getAuth(app);
    const loginLink = document.getElementById('loginLink');

    onAuthStateChanged(auth, user=>{
      if(!loginLink) return;
      if(user){
        loginLink.textContent = 'My Account';
        loginLink.href = 'my-account.html';
        loginLink.title = user.email || 'My Account';
      }else{
        loginLink.textContent = 'Login';
        loginLink.href = 'login.html';
        loginLink.removeAttribute('title');
      }
    });
  </script>
</body>
</html>
