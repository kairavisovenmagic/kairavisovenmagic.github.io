<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Products | Kairavi’s Oven Magic</title>
  <link rel="icon" href="images/logo.png"/>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta name="description" content="Freshly baked cookies & nankhatai made with 100% atta and pure butter. Order from Kairavi’s Oven Magic, Pune.">

  <style>
    :root{
      --bg:#FFF7F0; --ink:#1f2328; --muted:#6b7280;
      --brand:#f15a24; --brand-900:#cc4b1e; --ring:rgba(241,90,36,.22);
      --card:#fff; --stroke:#eee; --shadow:0 14px 40px rgba(0,0,0,.08);
      --radius:18px;
    }
    body{ background:var(--bg); color:var(--ink); }
    .products-hero{
      background:linear-gradient(180deg, #fff1e7 0%, #fff7f0 100%);
      border-bottom:1px solid #fde9de;
    }
    .products-hero-inner{
      max-width:1100px; margin:0 auto; padding:28px 16px 16px;
      display:flex; align-items:end; justify-content:space-between; gap:20px;
    }
    .products-title{ font-size:36px; margin:0; }
    .products-sub{ margin:6px 0 0; color:var(--muted) }
    .legend{ display:flex; gap:14px; align-items:center; color:var(--muted); }
    .legend-dot{ width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px; }
    .legend-dot.best{ background:#ff7a45; }
    .legend-dot.new{ background:#4ade80; }

    /* Filter bar */
    .filterbar{ position:sticky; top:0; z-index:5; background:rgba(255,247,240,.75); backdrop-filter: blur(6px); border-bottom:1px solid #f3e4db; }
    .filterbar-inner{ max-width:1100px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .filter-left{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .search-wrap{ position:relative; }
    .search-wrap i{ position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#9aa0a6; }
    .search-wrap input{
      width:300px; max-width:70vw; padding:10px 12px 10px 34px;
      border:1px solid #eadace; border-radius:12px; outline:none; background:#fff;
    }
    .search-wrap input:focus{ border-color:var(--brand); box-shadow:0 0 0 4px var(--ring); }
    .select, .check{ display:flex; align-items:center; gap:8px; border:1px solid #eadace; padding:8px 10px; border-radius:12px; background:#fff; }
    .select select{ border:0; outline:0; background:transparent; }
    .chip{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#fff; border:1px solid #eadace; cursor:pointer; }
    .chip input{ accent-color:var(--brand); }

    .filter-right{ display:flex; align-items:center; gap:10px; }
    .result-count{ color:var(--muted); }
    .btn{ display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid #eadace; background:#fff; cursor:pointer; }
    .btn-ghost{ background:#fff; }
    .btn:hover{ background:#fafafa; }

    /* Grid & card */
    .section-products .wrap{ max-width:1100px; margin:0 auto; padding:20px 16px 60px; }
    .pro-grid{ display:grid; gap:18px; grid-template-columns: repeat(1, 1fr); }
    @media (min-width:700px){ .pro-grid{ grid-template-columns: repeat(2, 1fr);} }
    @media (min-width:1020px){ .pro-grid{ grid-template-columns: repeat(3, 1fr);} }

    .pro-card{
      background:var(--card); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow);
      border:1px solid #ffe5d7; transition:transform .15s ease, box-shadow .15s ease;
    }
    .pro-card:hover{ transform:translateY(-4px); box-shadow:0 18px 50px rgba(0,0,0,.12); }
    .thumb{ aspect-ratio: 4/3; background:#fff6ef; display:block; overflow:hidden; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .ribbon{
      position:absolute; left:14px; top:14px; background:#fff; color:#d9480f; border:1px solid #ffd7c3;
      padding:6px 10px; font-size:12px; border-radius:999px; box-shadow:0 4px 12px rgba(0,0,0,.06);
    }
    .card-body{ padding:14px 14px 16px; position:relative; }
    .card-body h3{ margin:2px 0 6px; font-size:18px; }
    .meta{ color:var(--muted); display:flex; align-items:center; justify-content:space-between; }
    .price{ font-weight:700; color:#1f2937; }
    .row-actions{ margin-top:12px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .qty-control{ display:flex; align-items:center; gap:10px; border:1px solid #eadace; background:#fff; padding:8px 10px; border-radius:12px; }
    .qty-control button{ width:28px; height:28px; border-radius:10px; border:1px solid #eadace; background:#fff; cursor:pointer; }
    .qty-control .remove{ width:28px; }
    .addbtn{ background:var(--brand); color:#fff; border:1px solid var(--brand); padding:10px 14px; border-radius:12px; text-decoration:none; font-weight:600; }
    .addbtn:hover{ background:var(--brand-900); border-color:var(--brand-900); }

    /* Skeletons */
    .skeleton{ border-radius:var(--radius); background:linear-gradient(90deg,#f7e9df,#fff3ea,#f7e9df); background-size:200% 100%; animation:shimmer 1.2s infinite; height:280px; }
    @keyframes shimmer{ 0%{background-position: 0% 0} 100%{ background-position: -200% 0} }

    /* Toast */
    .toast{ position:fixed; left:50%; bottom:20px; transform:translateX(-50%); background:#1f2937; color:#fff; padding:10px 16px; border-radius:10px; opacity:0; transition:opacity .2s; z-index:9999; }
    .toast.show{ opacity:1; }
  </style>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4W0YRB7QQ2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date()); gtag('config', 'G-4W0YRB7QQ2');
  </script>
</head>
<body>

  <!-- FREE DELIVERY BAR -->
  <div class="freebar">
    FREE delivery over ₹999 • Pune city
    <a href="cart.html">View Cart →</a>
  </div>

  <!-- HEADER -->
  <header class="site-header">
    <div class="wrap nav">
      <a class="brand" href="index.html">
        <img src="images/logo.png" alt="Kairavi's Oven Magic logo">
        <strong>Kairavi’s Oven Magic</strong>
      </a>
      <nav class="menu">
        <a href="index.html">Home</a>
        <a href="products.html" aria-current="page">Products</a>
        <a href="contact.html">Contact</a>
        <a href="cart.html">Cart <span class="badge" id="cartCount">0</span></a>
        <a id="loginLink" href="login.html">Login</a>
        <a id="logoutLink" href="#" style="display:none">Logout</a>
      </nav>
    </div>
  </header>

  <!-- PAGE BANNER -->
  <section class="products-hero">
    <div class="products-hero-inner">
      <div>
        <h1 class="products-title">Our Cookies & Nankhatai</h1>
        <p class="products-sub">100% atta • Pure unsalted butter • No maida • No palm oil</p>
      </div>
      <div class="legend">
        <span class="legend-dot best"></span><span>Bestseller</span>
        <span class="legend-dot new"></span><span>New</span>
      </div>
    </div>
  </section>

  <!-- FILTER BAR -->
  <div class="filterbar" role="region" aria-label="Filters">
    <div class="filterbar-inner">
      <div class="filter-left">
        <div class="search-wrap">
          <i class="fa fa-magnifying-glass"></i>
          <input id="q" type="search" placeholder="Search by name (e.g., ragi, gulkand)…" aria-label="Search products"/>
        </div>

        <label class="select">
          <span>Max price</span>
          <select id="priceMax" aria-label="Maximum price">
            <option value="">No limit</option>
            <option value="200">₹200</option>
            <option value="250">₹250</option>
          </select>
        </label>

        <label class="chip"><input type="checkbox" id="onlyBest"> Bestseller only</label>

        <label class="select">
          <span>Sort</span>
          <select id="sortBy" aria-label="Sort products">
            <option value="popular">Popular</option>
            <option value="priceAsc">Price: Low → High</option>
            <option value="priceDesc">Price: High → Low</option>
            <option value="nameAsc">Name: A → Z</option>
          </select>
        </label>
      </div>

      <div class="filter-right">
        <div id="resultCount" class="result-count">Showing 0 items</div>
        <button class="btn btn-ghost" id="clearFilters" type="button"><i class="fa fa-rotate-right"></i> Clear</button>
      </div>
    </div>
  </div>

  <!-- SECTION: PRODUCTS GRID -->
  <section class="section section-products">
    <div class="wrap">
      <div class="pro-grid" id="productsGrid">
        <!-- skeletons -->
        <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="wrap footer-grid">
      <div class="small">© 2025 Kairavi’s Oven Magic — Kairavi Food Products</div>
      <div class="small" style="text-align:right">
        Email: <a href="mailto:kairavisovenmagic@gmail.com">kairavisovenmagic@gmail.com</a>
      </div>
    </div>
  </footer>

  <!-- WhatsApp Floating -->
  <a class="whatsapp-float" href="https://wa.me/919766964845?text=Hi%2C%20I%20want%20to%20order%20cookies" target="_blank" aria-label="Chat on WhatsApp">
    <img src="images/whatsapp.png" alt="WhatsApp">
  </a>

  <!-- ====== PRODUCTS + CART + FILTERS ====== -->
  <script>
    // ---- PRODUCT DATA (can add {new:true} for new tag) ----
    const PRODUCTS = [
      {name:"Gulkand Nankhatai", weight:"250 g", price:250, img:"images/gulkand.jpg", tags:"gulkand rose", best:true},
      {name:"Wheat Nankhatai",  weight:"250 g", price:200, img:"images/wheat.jpg",   tags:"wheat atta", best:true},
      {name:"Ragi Nankhatai",   weight:"250 g", price:250, img:"images/ragi.jpg",    tags:"ragi finger millet", new:true},
      {name:"Oats Nankhatai",   weight:"250 g", price:250, img:"images/oats.jpg",    tags:"oats"},
      {name:"Maize (Corn) Nankhatai", weight:"250 g", price:250, img:"images/maize.jpg",  tags:"maize corn"},
      {name:"Jowar Nankhatai",  weight:"250 g", price:250, img:"images/jowar.jpg",   tags:"jowar sorghum"},
      {name:"Upvas Nankhatai",  weight:"250 g", price:250, img:"images/upvas.jpg",   tags:"upvas fasting sabudana rajgira"},
      {name:"Chocolate Nankhatai", weight:"250 g", price:250, img:"images/chocolate.jpg", tags:"chocolate choco", best:true},
      {name:"Ajwain Sticks",    weight:"250 g", price:250, img:"images/ajwain-sticks.jpg", tags:"ajwain sticks"},
      {name:"Ajwain Cookies",   weight:"250 g", price:200, img:"images/ajwain-cookies.jpg", tags:"ajwain cookies"},
      {name:"Jeera Cookies",    weight:"250 g", price:250, img:"images/jeera.jpg", tags:"jeera cumin"},
      {name:"Mini Marble Cookies", weight:"250 g", price:200, img:"images/marble.jpg", tags:"marble vanilla chocolate"}
    ];

    // ---- CART STORAGE ----
    const CART_KEY = 'kom_cart';
    const getCart = () => JSON.parse(localStorage.getItem(CART_KEY) || '[]');
    const saveCart = (c) => { localStorage.setItem(CART_KEY, JSON.stringify(c)); updateCartCount(); flashToast('Added to cart'); };

    function updateCartCount(){
      const el = document.getElementById('cartCount');
      if(!el) return;
      const qty = getCart().reduce((s,i)=>s+i.qty,0);
      el.textContent = qty;
    }
    function flashToast(msg){
      let t=document.querySelector('.toast');
      if(!t){ t=document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
      t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1200);
    }

    // ---- RENDER PRODUCTS INTO GRID ----
    const grid = document.getElementById('productsGrid');

    function badgeHTML(p){
      const b = p.best ? `<div class="ribbon">Bestseller</div>` : '';
      const n = p.new  ? `<div class="ribbon" style="left:auto; right:14px; color:#065f46; border-color:#b7f7c4">New</div>` : '';
      return b+n;
    }

    function cardHTML(p) {
      const id = btoa(p.name).replace(/=/g,''); // simple id
      return `
        <article class="pro-card ${p.best?'best':''}" data-product="${p.name}" data-weight="${p.weight}" data-price="${p.price}" data-tags="${p.tags}">
          <div class="thumb">
            ${badgeHTML(p)}
            <img loading="lazy" src="${p.img}" alt="${p.name}">
          </div>
          <div class="card-body">
            <h3>${p.name}</h3>
            <div class="meta">
              <span>${p.weight}</span>
              <span class="price" data-price="${p.price}">₹${p.price}</span>
            </div>
            <div class="row-actions">
              <div class="qty-control" aria-label="Quantity control">
                <button class="minus" data-id="${id}">−</button>
                <span class="count" id="c-${id}">1</span>
                <button class="plus" data-id="${id}">+</button>
                <button class="remove" data-id="${id}" title="Reset"><i class="fa fa-trash"></i></button>
              </div>
              <a class="addbtn" data-id="${id}" href="#" rel="noopener">Add to Cart</a>
            </div>
          </div>
        </article>
      `;
    }

    function renderGrid(list = PRODUCTS){
      grid.innerHTML = list.map(cardHTML).join('');
      list.forEach(p=>{
        const id = btoa(p.name).replace(/=/g,'');
        const priceEl = grid.querySelector(`article[data-product="${p.name}"] .price`);
        const countEl = document.getElementById(`c-${id}`);
        const minus = grid.querySelector(`.minus[data-id="${id}"]`);
        const plus  = grid.querySelector(`.plus[data-id="${id}"]`);
        const reset = grid.querySelector(`.remove[data-id="${id}"]`);
        const add   = grid.querySelector(`.addbtn[data-id="${id}"]`);
        let qty = 1;
        const update = () => { priceEl.textContent = `₹${p.price * qty}`; countEl.textContent = qty; };

        minus.addEventListener('click', ()=>{ if(qty>1){ qty--; update(); }});
        plus .addEventListener('click', ()=>{ if(qty<10){ qty++; update(); }});
        reset.addEventListener('click', ()=>{ qty=1; update(); });
        add  .addEventListener('click', (e)=>{
          e.preventDefault();
          const cart = getCart();
          const key = `${p.name}|${p.weight}|${p.price}`;
          const found = cart.find(i=>i.key===key);
          if(found){ found.qty += qty; } else { cart.push({ key, name:p.name, weight:p.weight, price:p.price, qty }); }
          saveCart(cart);
          qty=1; update();
        });

        update();
      });

      updateCartCount();
      applyFilters(); // start with correct count
    }

    // ---- FILTERS & SORT ----
    const q = document.getElementById('q');
    const priceMax = document.getElementById('priceMax');
    const onlyBest = document.getElementById('onlyBest');
    const sortBy   = document.getElementById('sortBy');
    const clearFilters = document.getElementById('clearFilters');
    const resultCount = document.getElementById('resultCount');

    function applyFilters(){
      const term = q.value.trim().toLowerCase();
      const max  = priceMax.value ? parseInt(priceMax.value,10) : Infinity;
      const best = onlyBest.checked;

      const cards = [...grid.querySelectorAll('.pro-card')];
      let visible = 0;

      cards.forEach(card=>{
        const name  = card.dataset.product.toLowerCase();
        const tags  = (card.dataset.tags||'').toLowerCase();
        const price = parseInt(card.dataset.price,10);
        const isBest = card.classList.contains('best');

        const textMatch = !term || name.includes(term) || tags.includes(term);
        const priceMatch = price <= max;
        const bestMatch  = !best || isBest;

        const show = textMatch && priceMatch && bestMatch;
        card.style.display = show ? '' : 'none';
        if(show) visible++;
      });
      resultCount.textContent = `Showing ${visible} item${visible===1?'':'s'}`;

      // sort currently visible cards
      const sort = sortBy.value;
      const sorted = cards
        .filter(c => c.style.display !== 'none')
        .sort((a,b)=>{
          const pa = +a.dataset.price, pb = +b.dataset.price;
          const na = a.dataset.product.toLowerCase(), nb = b.dataset.product.toLowerCase();
          if (sort === 'priceAsc')  return pa - pb;
          if (sort === 'priceDesc') return pb - pa;
          if (sort === 'nameAsc')   return na.localeCompare(nb);
          // 'popular' keeps DOM order (bestsellers are already higher in PRODUCTS)
          return 0;
        });
      sorted.forEach(el=> grid.appendChild(el));
    }

    [q, priceMax, onlyBest, sortBy].forEach(el => el.addEventListener('input', applyFilters));
    clearFilters.addEventListener('click', ()=>{
      q.value=''; priceMax.value=''; onlyBest.checked=false; sortBy.value='popular'; applyFilters();
    });

    // initial render (delay to show skeleton briefly)
    setTimeout(()=> renderGrid(PRODUCTS), 200);
  </script>

  <!-- Toast stub -->
  <div class="toast" style="display:none"></div>

  <!-- ✅ Shared Auth header controls -->
  <script type="module">
    import { attachHeaderAuth } from "./auth.js?v=6";
    attachHeaderAuth();
  </script>
</body>
</html>
