<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Dashboard | Kairavi’s Oven Magic</title>
  <link rel="icon" href="images/logo.png"/><link rel="stylesheet" href="style.css"/>
  <style>
    /* same dashboard styles */
  </style>
</head>
<body>
  <div class="freebar">Admin Area • <a href="index.html">Go to Site →</a></div>
  <header class="site-header">
    <div class="wrap nav">
      <a class="brand" href="index.html"><img src="images/logo.png" alt=""><strong>Kairavi’s Oven Magic</strong></a>
      <nav class="menu">
        <a href="index.html">Home</a><a href="products.html">Products</a><a id="loginLink" href="my-account.html">My Account</a><a id="logoutBtn" href="#">Logout</a>
      </nav>
    </div>
  </header>

  <section class="admin-hero"><div class="wrap"><h1>Admin Dashboard</h1><p>View users and orders (Restricted access)</p></div></section>
  <section class="section"><div class="wrap" id="dashboard"></div></section>

  <!-- Firebase Admin Logic (same as provided before) -->
  <!-- ✅ Firebase Auth: Login ↔ My Account ↔ Admin Switch + Logout Popup -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
  import { getAuth, onAuthStateChanged, signOut } 
    from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';

  // --- CONFIG (yours) ---
  const firebaseConfig = {
    apiKey: "AIzaSyCk4rYYxGWI9XBLXiIR1uaIFAnf8WHZP2w",
    authDomain: "kairavis-oven-magic.firebaseapp.com",
    projectId: "kairavis-oven-magic",
    storageBucket: "kairavis-oven-magic.firebasestorage.app",
    messagingSenderId: "270897232759",
    appId: "1:270897232759:web:36ee0edc8b222046febf72"
  };

  // --- Init Firebase ---
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // --- Admin whitelist (add your admin emails here) ---
  const ADMIN_EMAILS = ['kairavisovenmagic@gmail.com'];

  // --- Elements ---
  const loginLink  = document.getElementById('loginLink');
  const logoutLink = document.getElementById('logoutLink');

  // --- Toast helper ---
  function toastMsg(msg) {
    let t = document.querySelector('.toast');
    if (!t) {
      t = document.createElement('div');
      t.className = 'toast';
      t.style.position = 'fixed';
      t.style.left = '50%';
      t.style.bottom = '20px';
      t.style.transform = 'translateX(-50%)';
      t.style.background = '#333';
      t.style.color = '#fff';
      t.style.padding = '10px 18px';
      t.style.borderRadius = '10px';
      t.style.opacity = '0';
      t.style.transition = 'opacity .25s';
      t.style.zIndex = '9999';
      document.body.appendChild(t);
    }
    t.textContent = msg;
    t.style.opacity = '1';
    setTimeout(() => { t.style.opacity = '0'; }, 1200);
  }

  // --- Update header links depending on user role ---
  onAuthStateChanged(auth, (user) => {
    if (!loginLink) return;
    if (user) {
      const email = (user.email || '').toLowerCase();
      const isAdmin = ADMIN_EMAILS.includes(email);
      loginLink.textContent = isAdmin ? 'Admin' : 'My Account';
      loginLink.href = isAdmin ? 'admin.html' : 'my-account.html';
      loginLink.title = user.email;
      if (logoutLink) logoutLink.style.display = '';
    } else {
      loginLink.textContent = 'Login';
      loginLink.href = 'login.html';
      loginLink.removeAttribute('title');
      if (logoutLink) logoutLink.style.display = 'none';
    }
  });

  // --- Logout behavior ---
  if (logoutLink) {
    logoutLink.addEventListener('click', async (e) => {
      e.preventDefault();
      if (!confirm('Log out from Kairavi’s Oven Magic?')) return;
      try {
        await signOut(auth);
        toastMsg('Logged out successfully!');
        setTimeout(() => { window.location.href = 'index.html'; }, 900);
      } catch (err) {
        alert('Logout failed: ' + (err?.message || err));
      }
    });
  }
</script>

</body>
</html>
